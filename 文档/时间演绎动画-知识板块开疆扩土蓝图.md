## 设计初衷
- 我希望在用户使用渐进激励播放器AI总结旧卡片笔记标签的过程中，同时让AI对于一个大领域知识树进行维护和拓展。在我们总结并添加笔记里面的obsidian标签的同时，还要去添加/修改相应的思维导图卡片笔记链接等等的json数据，让其能自动化点滴记录模块化卡片语境下对于某个知识块的渐进式进展。
- 我希望这个大领域知识树可以支持某种关于时间演绎的丝滑动画，直观的展示以天为单位的知识块掌握程度、体系中新的节点疆域拓展情况。这里面用一种量化的方式，动态展示上万多个语境块卡片笔记md在时间线上对于这个知识树节点的映射关系，展示逐个节点知识的实际语境卡片笔记链接，展示新节点知识的拓展方向。

## 卡片笔记链接
- “插入卡片笔记”这个功能也会出现在上方工具栏，和“插入超链接”、“插入标签”之类的功能并列。

### 顶部工具栏图标
- 这个工具栏按钮的图标要风格类似其它工具栏图标，如果是svg格式，就画一个差不多的。
- 由于是给某个节点添加卡片笔记，这个图标也要和其它图标一样，当用户没有点击某个节点的时候，灰色无法交互。

### 插入卡片笔记面板
- 这个面板的前端窗口，类似标签设定颜色的那个窗口，小小的，在节点位置的地方弹出，样式差不多，那个标签设定颜色窗口本身有什么昼夜之类的设计或者别的特化设计，也沿用过来。
- 这里也使用类似于“插入超链接”面板里面，有一个标签页叫做“Obsidian文件”，在输入md文件的名称的时候，支持直接搜索文件名的功能。这是一个非常实用的现有功能，照抄过来就行，不过关于数据结构方面，需要再设计。

### 节点卡片笔记交互
- 插入卡片笔记后，思维导图对应节点会出现一个矩形数字按钮。类似插入标签的那种矩形，同样在节点内部，但是矩形大小要小一些。这个矩形里面会用数字显示该思维导图节点的卡片笔记链接数量。
- 当鼠标点击数字按钮的时候，就会出现卡片笔记节点。这里使用同样的思维导图节点渲染方案，但是线固定为虚线，子节点为固定样式，每个节点是一个obsidian的[[]]双向链接，[[]]里面是笔记的标题。这里我们需要采用obsidian插件官方支持的功能——ctrl键+鼠标悬浮在某个双向链接上面的时候，召唤一个悬浮预览窗口。

## 时间演绎动画
- 这个动画是一种底部滑动时间线的横转轮控制的，上面标着按天为单位的时间，可以滚动到具体那天。

### 三个动画
- 目前想到了三个方面要做的动画：节点的智能展开/收缩动画、节点的卡片笔记数量升降动画、节点熟悉度颜色动画，并且还希望加个类似游戏的相机这样的概念。

#### 节点的智能展开/收缩动画
- 当滑动到某一天的时候，丝滑的动画展开这xx天（默认为1天）以来见证的、开拓的节点，收缩已经超出这xx天（默认为1天）时间范畴未见证的、未开拓的节点，并且默认除了激活状态的节点，一般都是收缩的。这里的“见证”和“开拓”比较抽象，其实分别说的是“创建对应节点关联的卡片笔记链接”和“创建新节点”的时候。
- 这里的相机是一种缩小画布的，较为全局的，居中固定的。

#### 节点的卡片笔记数量升降动画
- 当滑动到某一天的时候，对应节点的卡片笔记数量如果有升/降，就有类似滚轮数字那种会有一种升降动画，同时还配有灵动且游戏化的小图标动画（比如up/down那种）。
- 这里的相机是一种放大画布的，局部的，运动的。自从上面展开收缩动画后，相机就开始跟踪升降动画的区域，逐个区域做滚轮数字升降动画，然后进入下一个区域。区域的转移是一种相机移动产生的动画。
- 这里牵扯到一种，子结点卡片笔记的都是父节点的所属的复杂情况，只要父节点把含有卡片笔记链接的子结点收缩进去的时候，父节点就会统计所有子结点的卡片笔记链接，当成自己的。父节点自己也可以拥有卡片笔记链接。

#### 节点熟悉度颜色动画
- 使用一种类似遗忘曲线记忆衰减算法，基于滑动到的某一天之前的实质掌握/复习该知识点的数据和天数间隔，算出该知识点的熟悉度，然后按照红到绿的渐变，映射熟悉度给节点背景颜色。
- 这里怎么确定实质掌握/实质复习，其实有争议。我有往很复杂的方面思考，就是比如一天内如果有3个卡片笔记提到这个知识点，就自动给与“实质掌握”的标记。复习就是当天有1次卡片笔记提到这个知识点，就算“实质复习”。并且可以手动去标记“实质掌握”。
- 这里的相机重新回到一种缩小画布的，较为全局的，居中固定的。回到居中相机位置，才开始触发熟悉度颜色动画，给人一种熟悉的板块在哪些地方有所变化的感觉。
- 这里依旧牵扯到一种，子结点卡片笔记的都是父节点的所属的复杂情况，父节点的熟悉度颜色怎么确定呢？直接根据子结点的颜色进度，做一种平均值吧。

### 数据和渲染相关设计
- 上述的动画功能，实现起来会非常复杂，特别是我开头吹的牛“动态展示上万多个语境块卡片笔记md在时间线上对于这个知识树节点的映射关系”，这里明显会导致动画过程非常僵硬，掉帧。我们需要一个足够优化的数据和渲染相关的。

## 渐进激励播放器的AI
- 渐进激励播放器的AI会完全代理节点创建、传递给对应节点卡片笔记链接的过程。